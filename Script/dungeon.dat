/* 
 * NOTICE!!!
 * This file contains SPOILERS, which might ruin your IVAN experience totally.
 */

Dungeons = 4;
Teams = 10;

/*
 * Description of hard-coded teams:
 * 0 == PLAYER_TEAM == Player and pets
 * 1 == MONSTER_TEAM == Monsters, default relation to other teams == hostile
 * 2 == ATTNAM_TEAM == Residents of Attnam
 * 3 == FINAL_BATTLE_TEAM == Petrus's team during the Final Battle
 * 8 == NEW_ATTNAM_TEAM == natives and ostriches of New Attnam
 * 9 == COLONIST_TEAM == colonists of New Attnam
 */

Team ATTNAM_TEAM;
{
	Relation 0, FRIEND;
	AttackEvilness = 250;
}

/* Script defined teams: */

Team 4; /* obsolete */
{
	Relation 0, HOSTILE;
	Relation 2, HOSTILE;
	Relation 3, HOSTILE;
}

Team 5; /* Spawned hostile angels */
{
	Relation 0, HOSTILE;
	Relation 1, UNCARING;
	Relation 4, HOSTILE;
}

Team 6; /* Dungeon shopkeepers */
{
	Relation 1, UNCARING;
	Relation 4, HOSTILE;
	AttackEvilness = 100;
}

Team 7; /* Ivan */
{
	Relation 4, HOSTILE;
	AttackEvilness = 100;
}

Team NEW_ATTNAM_TEAM;
{
	Relation 0, FRIEND;
	Relation 4, HOSTILE;
	AttackEvilness = 200;
}

Team COLONIST_TEAM;
{
	Relation 4, HOSTILE;
	Relation 1, UNCARING;
}

Dungeon ELPURI_CAVE;
{
	Levels = 10;
	Variable XSize = 64;
	Variable YSize = 36;
	Description = "gloomy cave";
	ShortDescription = "GC";

	LevelDefault
	{
		FillSquare = solidterrain(GROUND),wall(EARTH);
		Size = XSize, YSize;
		Rooms = 10+rand%21;
		Items = 25+rand%26;
		GenerateMonsters = true;
		ReCalculate = true;
		OnGround = false;
		TeamDefault = MONSTER_TEAM;
		AmbientLight = 0;
		LOSModifier = 16;
		IgnoreDefaultSpecialSquares = false;
		DifficultyBase = 80;
		DifficultyDelta = 20;
		MonsterAmountBase = 10;
		MonsterAmountDelta = 4;
		MonsterGenerationIntervalBase = 50;
		MonsterGenerationIntervalDelta = -5;

		Square, Random NOT_WALKABLE|NOT_IN_ROOM;
		{
			Items == stone;
			Times = 25+rand%25;
		}

		Square, Random;
		{
			Items == mine { Team = MONSTER_TEAM; Active = true; }
			Times = rand%4;
		}

		Square, Random;
		{
			Items == beartrap { Team = MONSTER_TEAM; Active = true; }
			Times = rand%4;
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN);
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}

		RoomDefault
		{
			Pos = 2+rand%(XSize-6),2+rand%(YSize-6);
			Size = 4+rand%8,4+rand%8;
			AltarPossible = true;
			WallSquare = solidterrain(GROUND),wall(BRICK_OLD);
			FloorSquare = solidterrain(PARQUET),empty;
			DoorSquare = solidterrain(PARQUET),door;
			GenerateDoor = true;
			ReCalculate = true;
			DivineMaster = 0;
			GenerateTunnel = true;
			GenerateLanterns = true;
			Type = normalroom;
			GenerateFountains = true;
			AllowLockedDoors = true;
			AllowBoobyTrappedDoors = true;
			Shape = RECTANGLE;
		}
	}

	Level rand%3;
	{
		LevelMessage = "You hear many wolves howling. You shiver.";
		Rooms = 10+rand%21;

		Room 1;
		{
			Size = 7,7;
			AltarPossible = false;
			Shape = ROUND_CORNERS;

			CharacterMap
			{
				Pos = 1,1;
				Size = 5,5;

				Types
				{
					w = wolf;
					W = werewolfhuman { Inventory = { 2, scrollofenchantweapon, scrollofenchantarmor; } }
				}
			}
			{
				.www.
				wwwww
				wwWww
				wwwww
				.www.
			}
		}
	}

	Level 1+rand%3;
	{
		Rooms = 10+rand%21;

		Room 2;
		{
			Size = 5,9;
			AltarPossible = false;
			DivineMaster = MELLIS;
			Type = shop;
			GenerateFountains = false;

			CharacterMap
			{
				Pos = 1, 1;
				Size = 3, 7;

				Types
				{
					g = guard(SHOP) { Team = 6; }
					s = shopkeeper(ELPURI_CAVE) { Team = 6; IsMaster = true; }
				}
			}
			{
				g.g
				...
				...
				.s.
				...
				...
				g.g
			}

			ItemMap
			{
				Pos = 1,1;
				Size = 3,7;

				Types
				{
					g = { 2, IRON gauntlet, IRON gauntlet; }
					b = { 2, IRON boot, IRON boot; }
					a == Random { MinPrice = 200; MaxPrice = 10000; Category = HELMET|CLOAK|BODY_ARMOR|BELT; }
					d == Random { MinPrice = 200; MaxPrice = 10000; Category = RING|AMULET; }
					w == Random { MinPrice = 200; MaxPrice = 10000; Category = WEAPON|SHIELD; }
					e == Random { MinPrice = 50; MaxPrice = 10000; Category = FOOD|POTION; }
					u == Random { MinPrice = 200; MaxPrice = 10000; Category = WAND|TOOL; }
					r == Random { MinPrice = 200; MaxPrice = 10000; Category = SCROLL|BOOK; }
					s == wandofstriking;
				}
			}
			{
			    .g.
				ddb
			    err
			    e.w
			    auw
				auw
			    .s.
			}
		}
	}

	Level 4;
	{
		LevelMessage = "You hear a wailing scream in the distance. An enner beast must dwell in the level!";
		IgnoreDefaultSpecialSquares = true;
		Rooms = 10+rand%21;
		Items = 50+rand%51;

		Square, Random NOT_WALKABLE|NOT_IN_ROOM;
		{
			Items == stone;
			Times = 25+rand%25;
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN);
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}

		Square, Random;
		{
			Items == bone;
			Times = 20;
		}

		Square, Random;
		{
			Items == skull;
			Times = 5;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character = ennerbeast;
		}
	}

	Level 5;
	{
		LevelMessage = "You hear someone singing loudly: \"Uncle Lenin lives in Russia...\"";
		Rooms = 10+rand%21;

		Room 0; /* vault */
		{
		
			GenerateLanterns = false;
			GenerateFountains = false;
			WallSquare = solidterrain(GROUND),wall(EARTH);
			GenerateDoor = false;
			GenerateTunnel = false;
			AltarPossible = false;
			Size = 7,7;

			OTerrainMap
			{
				Pos = 1,1;
				Size = 5,5;
				Types
				{
					x = IRON wall(BRICK_OLD);
				}
			}
			{
				xxxxx
				x...x
				x...x
				x...x
				xxxxx
			}

			Square, Random;
			{
				Items == mine { Team = MONSTER_TEAM; Active = true; Chance = 50; }
				Times = 2;
			}

			Square, Random;
			{
				Items == beartrap { Team = MONSTER_TEAM; Active = true; Chance = 50; }
				Times = 2;
			}

			Square, Pos 3,3;
			{
				Items == itemcontainer(CHEST) 
				{
					ItemsInside = { 5,	Random { MinPrice = 1000; },
										Random { MinPrice = 1000; },
										stone { Chance = 75; },
										stone { Chance = 75; },
										stone { Chance = 75; } } 
				}
			}
		}

		Square, Random NOT_IN_ROOM;
		{
			Character = communist { Team = 7; }
		}
		
	}

	Level DARK_LEVEL;
	{
		Description = "dark level";
		ShortDescription = "DarkLevel";
		LevelMessage = "You shudder as you sense a being of pure darkness nearby. Your goal is near.";
		FillSquare = solidterrain(FLOOR), IRON wall(BRICK_OLD);
		Items = 0;
		IgnoreDefaultSpecialSquares = true;

		RoomDefault
		{
			AltarPossible = false;
			WallSquare = solidterrain(FLOOR), IRON wall(BRICK_OLD);
			DoorSquare = solidterrain(PARQUET), IRON door;
			GenerateLanterns = false;
			GenerateFountains = false;
		}

		Room 0;
		{
			Size = 11, 11;
			DivineMaster = SCABIES;

			Square, Pos 5, 5;
			{
				OTerrain = portal(DARK_LEVEL) { AttachedArea = 7; AttachedEntry = RANDOM; }
				Character = elpuri;
			}

			Square, Random;
			{
				Character = frog(DARK);
				Times = 10;
			}

			Square, Random;
			{
				Character = frog(GREATER_DARK);
				Times = 5;
			}

			Square, Random;
			{
				Items == HUMAN_FLESH lump;
				Times = 5;
			}

			Square, Random;
			{
				Items == bone;
				Times = 10;
			}

			Square, Random;
			{
				Items == skull;
				Times = 5;
			}
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}
	}

	Level 5+rand%4;
	{
		Rooms = 10+rand%21;

		Room 1;
		{
			Size = 7,7;
			AltarPossible = false;
			Shape = ROUND_CORNERS;

			CharacterMap
			{
				Pos = 1,1;
				Size = 5,5;

				Types
				{
					G = golem;
				}
			}
			{
				.GGG.
				GGGGG
				GGGGG
				GGGGG
				.GGG.
			}
		}
	}

	Level 7;
	{
		IgnoreDefaultSpecialSquares = true;

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN);
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}
	}

	Level 8;
	{
		IgnoreDefaultSpecialSquares = true;

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}

		Room 0;
		{
			Size = 7,7;
			AltarPossible = false;
			WallSquare = solidterrain(GROUND),IRON wall(BRICK_OLD);
			FloorSquare = solidterrain(PARQUET),empty;
			DoorSquare = solidterrain(PARQUET),IRON door;

			Square, Pos 3,3;
			{
				OTerrain = portal(OREE_LAIR_ENTRY) { AttachedArea = OREE_LAIR; AttachedEntry = STAIRS_UP; }
			}

			Square, Pos 3,5;
			{
				EntryIndex = STAIRS_DOWN;
			}
		}

		Square, Random;
		{
			Items == pickaxe;
		}
	}

	Level OREE_LAIR;
	{
		Description = "Oree's lair";
		ShortDescription = "OreeLair";
		LevelMessage = "\"Welcome to my lair, mortal! There's no escape now!\"";
		FillSquare = solidterrain(FLOOR), IRON wall(BRICK_OLD);
		Rooms = 1;
		GenerateMonsters = false;
		Items = 0;
		IgnoreDefaultSpecialSquares = true;

		Room 0;
		{
			Size = 9,9;
			AltarPossible = false;
			WallSquare = solidterrain(FLOOR), IRON wall(BRICK_OLD);
			FloorSquare = solidterrain(PARQUET),empty;
			GenerateDoor = false;
			DivineMaster = MORTIFER;
			GenerateFountains = false;
			GenerateLanterns = false;

			Square, Pos 4,1;
			{
				OTerrain = STEEL altar(MORTIFER);
			}

			Square, Pos 4,4;
			{
				EntryIndex = STAIRS_UP;
			}

			Square, Pos 4,7;
			{
				OTerrain = portal(OREE_LAIR_EXIT) { AttachedArea = 0; AttachedEntry = RANDOM; }
			}

			CharacterMap
			{
				Pos = 1,1;
				Size = 7,7;

				Types
				{
					O = oree;
					B = darkknight(ELITE);
					G = golem(BLOOD);
					A = angel(MORTIFER);
				}
			}
			{
				..O.A..
				.......
				..BBB..
				G.B.B.G
				..BBB..
				.......
				..G.G..
			}
		}
	}
}

Dungeon ATTNAM;
{
	Levels = 1;
	Variable XSize = 61;
	Variable YSize = 62;

	Level 0;
	{
		Description = Attnam;
		ShortDescription = Attnam;
		FillSquare = solidterrain(SNOW_TERRAIN),empty;
		Size = XSize, YSize;
		GenerateMonsters = false;
		Rooms = 20 + rand % 6;
		Items = 0;
		ReCalculate = false;
		OnGround = true;
		TeamDefault = ATTNAM_TEAM;
		AmbientLight = rgb24(100, 100, 100);
		LOSModifier = 48;
		IgnoreDefaultSpecialSquares = false;

		RoomDefault
		{
			Pos = 2+rand%(XSize-6),2+rand%(YSize-6);
			Size = 4+rand%8,4+rand%8;
			AltarPossible = false;
			WallSquare = solidterrain(SNOW_TERRAIN),wall(BRICK_FINE);
			FloorSquare = solidterrain(PARQUET),empty;
			DoorSquare = solidterrain(PARQUET),door;
			GenerateDoor = true;
			ReCalculate = true;
			DivineMaster = 0;
			GenerateTunnel = false;
			GenerateLanterns = true;
			Type = normalroom;
			GenerateFountains = false;
			AllowLockedDoors = false;
			AllowBoobyTrappedDoors = false;
			Shape = RECTANGLE;
		}

		Square, Pos 0, 0;
		{
			Character = guard(PATROL) { WayPoint = { 4, 0, 0, XSize - 1, 0, XSize - 1, YSize - 1, 0, YSize - 1; } }
		}

		Square, Random NOT_IN_ROOM;
		{
			OTerrain = decoration(SNOW_PINE);
			Times = 200;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character = hunter;
			Times = 10;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character = polarbear;
			Times = 5;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character = farmer;
			Times = 5;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character = housewife;
			Times = 5;
		}

		Square, Pos 30,61;
		{
			EntryIndex = STAIRS_UP;
		}
	
		Room 0;
		{
			Pos = 10,10;
			Size = 41,42;
			WallSquare = solidterrain(SNOW_TERRAIN),STONE wall(BRICK_FINE);
			FloorSquare = solidterrain(SNOW_TERRAIN),empty;
			GenerateDoor = false;
			ReCalculate = false;
			DivineMaster = VALPURUS;
			GenerateLanterns = false;
			Type = cathedral;

			Square, Pos 1, 1;
			{
				Character = guard(PATROL) { WayPoint = { 4, 11, 11, 49, 11, 49, 50, 11, 50; } }
			}

			Square, Pos 19, 41;
			{
				OTerrain = empty;
			}

			Square, Pos 20, 41;
			{
				OTerrain = empty;
			}

			Square, Pos 21, 41;
			{
				OTerrain = empty;
			}
			
			GTerrainMap
			{
				Pos = 4,4;
				Size = 33,34;
				Types
				{
					# = MARBLE solidterrain(FLOOR);
					- = MARBLE solidterrain(FLOOR);
					~ = liquidterrain(POOL);
				}
			}
			{
				............#########............
				............#-------#............
				####......###-------###......####
				#--#......#-----------#......#--#
				#--#....###-----------###....#--#
				#--#....#---------------#....#--#
				#--###..#---------------#..###--#
				#----#..#---------------#..#----#
				#----#..#---------------#..#----#
				###--#..###-----------###..#--###
				..#--###..#-----------#..###--#..
				..#----#..#-----------#..#----#..
				..###--####-----------####--###..
				....#-----#-----------#-----#....
				....#-----#-----------#-----#....
				....####--#-----------#--####....
				.......#--#-----------#--#.......
				......###-#-----------#-###......
				..#####-#-#-----------#-#-#####..
				.##-------#-----------#-------##.
				.#---~~~#-#-----------#-#------#.
				.#---~~~#-#-----------#-#------#.
				.##--~~~#-#-----------#-#-----##.
				..##-~~~#-#-----------#-#----##..
				...##~~~#-######-######-#---##...
				....#~~~#---------------#---#....
				....#~~~#---------------#---#....
				...#######---###-###---#######...
				####---------#.....#---------####
				#--------#####.....#####--------#
				#--------#.............#--------#
				##---#####.............#####---##
				.##--#.....................#--##.
				..####.....................####..
			}

			OTerrainMap
			{
				Pos = 1,1;
				Size = 39,40;
				Types
				{
					# = MARBLE wall(BRICK_FINE);
					@ = MARBLE wall(BRICK_PROPAGANDA);
					T = throne;
					| = decoration(CARPET);
					A = VALPURIUM altar(VALPURUS);
					D = MARBLE door;
					L = MARBLE door { Parameters = LOCKED; }
					b = decoration(SNOW_FIR);
					1 = decoration(POOL_CORNER) { VisualEffects = NONE; }
					2 = decoration(POOL_CORNER) { VisualEffects = MIRROR; }
					3 = decoration(POOL_CORNER) { VisualEffects = MIRROR | FLIP; }
					4 = decoration(POOL_CORNER) { VisualEffects = FLIP; }
					5 = decoration(POOL_BORDER) { VisualEffects = NONE; }
					6 = decoration(POOL_BORDER) { VisualEffects = ROTATE; }
					7 = decoration(POOL_BORDER) { VisualEffects = FLIP; }
					8 = decoration(POOL_BORDER) { VisualEffects = MIRROR | ROTATE; }
					s = decoration(COUCH);
					f = fountain { ContainedMaterial = ICE; }
					d = decoration(DOUBLE_BED);
					B = GOLD boulder; 
				}
			}
			{
				b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b
				.......................................
				b...b...b..b...b.b.b.b.b...b..b...b...b
				..b...b........#########........b...b..
				b....b.......bb#.......#bb.......b....b
				...####b..b..###.......###..b..b####...
				b.b#..#.b....#...........#....b.#.B#b.b
				...#..#....###...........###....#..#...
				b.b#..#b..b#.....T...T.....#b..b#..#b.b
				...#..###..#.......|.......#..###.B#...
				b.b#....#.b#.......|.......#b.#....#b.b
				...#....#..#.......|.......#..#B...#...
				b.b###..#b.###.....|.....###.b#..###b.b
				....b#..#@#.b#.....|.....#b.#@#.B#b....
				b....#....#..#.....|.....#..#..B.#....b
				..bb.###..####.....|.....####..###.bb..
				b.....b#.....#.....|.....#...B.#b.....b
				.b..b..#.....#.....|.....#.B...#..b..b.
				b..b...####..#.....|.....#..####...b..b
				b....b....#..#.....|.....#.B#....b....b
				.b.b....b###D#.....|.....#D###b....b.b.
				b...b#####.#.#.....|.....#.#.#####b.b.b
				....##.....D.#.....|.....#.D.....##....
				b..b#.s.152#.#.....|.....#.#......#b..b
				.b..#...8.6#.#.....|.....#.#..A...#..b.
				b...##..8.6#.#.....|.....#.#.....##...b
				....b##.8.6#.#...........#.#....##b....
				b.b..b##8.6#.######D######.#...##b..b.b
				.......#8.6#...............#...#.......
				b...b.b#473#...............#...#b.b...b
				.b....##@####...###D###...####@##....b.
				b..####.s.s.D...#.b.b.#...L.....####..b
				..b#.d......#####.f.f.#####........#b..
				b..#....s.s.#b..b.....b..b#........#..b
				.b.##...#####.bb..b.b..bb.#####...##.b.
				b..b##s.#b.b......f.f......b.b#..##b..b
				....b####....b...........b....####b....
				b.b...b...b.......b.b.......b...b...b.b
				...............bb.f.f.bb...............
				b.b.b.b.b.b.b.b..b...b..b.b.b.b.b.b.b.b
			}

			ItemMap
			{
				Pos = 4,4;
				Size = 33,34;
				Types
				{
					# == 0;
					a == avatarofvalpurus;
					b == banana;
					k == kiwi;
					p == pineapple;
					o == IRON meleeweapon(HALBERD);
					l == MITHRIL MITHRIL meleeweapon(LONG_SWORD);
					t == IRON IRON meleeweapon(TWO_HANDED_SWORD);
					m == IRON meleeweapon(MACE);
					s == IRON meleeweapon(SPEAR);
					c == bodyarmor(CHAIN_MAIL);
					e == backpack;
					g == GOLD stone;
					i == SILVER stone;
					h == SAPPHIRE stone;
					r == RUBY stone;
					d == DIAMOND stone;
					1 == lantern { SideStackIndex = UP; }
					2 == lantern { SideStackIndex = DOWN; }
					3 == lantern { SideStackIndex = RIGHT; }
					4 == lantern { SideStackIndex = LEFT; }
					C == GOLD itemcontainer(CHEST) { ItemsInside = { 5, GOLD helmet, stone, stone, stone, GOLD banana; } }
					F == ring(RING_OF_FIRE_RESISTANCE); 
					I == ring(RING_OF_INVISIBILITY);
					E == amulet(AMULET_OF_ESP);
					S == GOLD GOLD meleeweapon(LONG_SWORD);
					U == DIAMOND helmet(HELM_OF_UNDERSTANDING);
					A == GOLD helmet(HELM_OF_ATTRACTIVITY);
					L == oillamp;
					P == GOLD bodyarmor(PLATE_MAIL);
					O == GOLD cloak;
					W == wandofpolymorph;
				}
			}
			{
				............##2###2##............
				............#.......#............
				####......###.......###......####
				#..#......#...........#......#r.#
				#..#....###...........###....#gi#
				#..#....#...d.....a.d...#....#hC#
				#..###..#......p.p......#..###I.#
				#...e#..#......b.b......#..#EOLF#
				#...e#..#......k.k......#..#.dPS#
				##1.e#..##1.r..p.p..r.1##..#Ug1##
				..#.e4##..#....b.b....#..##3r.#..
				..#....#..#....k.k....#..#Wh.L#..
				..###..4###....p.p....###3Fi###..
				....#.....3.h..b.b..h.4P.A.I#....
				....#.....#....k.k....#r.gEd#....
				....###3..#....p.p....#Sd4###....
				.......#..#....b.b....#h.#.......
				......###.3.i..k.k..i.4.###......
				..#####.#.#....p.p....#.#.#####..
				.##.......#....b.b....#.......##.
				.#......3.#....k.k....#.4......#.
				.#......#.3.g..p.p..g.4.#......#.
				.##.....4.#....b.b....#.3.....##.
				..##....#.#...........#.#....##..
				...##...#.##2###.###2##.#...##...
				....#...4...............3...#....
				....#...#...............#...#....
				...###2###...##2.2##...###2###...
				####.........#.....#....ooool####
				#........#####.....#####.....ttc#
				#........#.............#ssss...c#
				##...#####.............#####mm.##
				.##..#.....................#mm##.
				..####.....................####..
			}

			CharacterMap
			{
				Pos = 4,4;
				Size = 33,34;
				Types
				{
					# = 0;
					P = petrus { IsMaster = true; }
					g = guard(VETERAN);
					e = guard(ELITE);
					m = guard(MASTER);
					p = priest;
					d = dolphin;
					l = frog(LIGHT);
					f = frog(GREATER_LIGHT);
					s = femaleslave(ATTNAM);
					1 = petrusswife(1);
					2 = petrusswife(2);
					3 = petrusswife(3);
					4 = petrusswife(4);
					5 = petrusswife(5);
					6 = petrusswife(6);
					k = kamikazedwarf(VALPURUS);
				}
			}
			{
				............#########............
				............#g.....g#............
				####......###...m...###......####
				#k.#......#g....l....g#......#..#
				#k.#....###...........###....#..#
				#k.#....#e...sPs.s.s...e#....#..#
				#k.###..#...............#..###..#
				#k...#..#..l....f....l..#..#....#
				#k...#..#e.............e#..#....#
				###..#..###...........###..#..###
				..#..###..#...........#..###..#..
				..#....#..#g.l.....l.g#..#....#..
				..###k.####...........####..###..
				....#k...k#...........#.e...#....
				....#k...k#...........#.....#....
				....####.k#g.........g#..####....
				.......#..#...........#..#.......
				......###.#...........#.###......
				..#####e#.#...........#.#.#####..
				.##.......#g.........g#.......##.
				.#......#.#...........#.#..p...#.
				.#....d.#.#...........#.#......#.
				.##...d.#.#...........#.#.....##.
				..##.d.d#.#g.........g#.#....##..
				...##.d.#.######.######.#...##...
				....#.d.#......g.g......#...#....
				....#...#...............#...#....
				...#######...###.###..g#######...
				####.3.5.....#g...g#..g......####
				#.1......#####.....#####........#
				#....4.6.#.............#........#
				##...#####.............#####...##
				.##2.#.....................#..##.
				..####.....................####..
			}
		}

		Room 1;
		{
			Pos=32,53;
			Size = 7,6;
			WallSquare = solidterrain(SNOW_TERRAIN),wall(BRICK_FINE);
			FloorSquare = solidterrain(PARQUET),empty;
			GenerateDoor = false;
			DivineMaster = MELLIS;
			Type = shop;
			GenerateLanterns = false;
			ReCalculate = false;
			
			Square, Pos 3, 5;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = door;
			}

			Square, Pos 1, 1;
			{
				Character = slave;
			}

			Square, Pos 1, 4;
			{
				Items == banana;
				Times = 100;
			}

			Square, Pos 5, 1;
			{
				Character = shopkeeper(ATTNAM) { IsMaster = true; }
			}


			Square, Pos 3, 0;
			{
				OTerrain = STONE wall(BRICK_PROPAGANDA);
			}

			ItemMap
			{
				Pos = 0,0;
				Size = 7,5;
				Types
				{
					# == 0;
					a == Random { MinPrice = 50; MaxPrice = 2000; Category = HELMET|CLOAK|BODY_ARMOR|BELT; }
					d == Random { MinPrice = 50; MaxPrice = 2000; Category = RING|AMULET; }
					w == Random { MinPrice = 50; MaxPrice = 2000; Category = WEAPON|SHIELD; }
					e == Random { MinPrice = 10; MaxPrice = 2000; Category = FOOD|POTION; }
					u == Random { MinPrice = 50; MaxPrice = 2000; Category = WAND|TOOL; }
					v == Random { MinPrice = 500; MaxPrice = 2000; Category = ANY_CATEGORY; }
					f == WOLF_FLESH lump;
					i == can { ContainedMaterial = POLAR_BEAR_FLESH; }
					l == lantern;
					2 == lantern { SideStackIndex = DOWN; }
					3 == lantern { SideStackIndex = RIGHT; }
					4 == lantern { SideStackIndex = LEFT; }
				}
			}
			{
				##2#2##
				#.aaa.#
				#edduw#
				3efluw4
				#.eivw#
			}
		}

		Room 2;
		{
			Pos=54,55;
			Size = 5,5;
			WallSquare = solidterrain(SNOW_TERRAIN),STEEL wall(BRICK_FINE);
			GenerateDoor = false;
			DivineMaster = LEGIFER;
			Type = temple;
			GenerateLanterns = false;
			ReCalculate = false;

			Square, Pos 2, 0;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = STEEL door;
			}

			Square, Pos 3, 0;
			{
				Items == lantern { SideStackIndex = DOWN; }
			}

			Square, Pos 2, 2;
			{
				OTerrain = STEEL altar(LEGIFER);
			}

			Square, Pos 2, 3;
			{
				Character = priest { IsMaster = true; }
			}
		}

		Room 3;
		{
			Pos=2,55;
			Size = 5,5;
			WallSquare = solidterrain(SNOW_TERRAIN),MARBLE wall(BRICK_FINE);
			GenerateDoor = false;
			DivineMaster = DULCIS;
			Type = temple;
			GenerateLanterns = false;
			ReCalculate = false;

			Square, Pos 4, 2;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = MARBLE door;
			}

			Square, Pos 4, 3;
			{
				Items == lantern { SideStackIndex = LEFT; }
			}

			Square, Pos 2, 2;
			{
				OTerrain = MARBLE altar(DULCIS);
			}

			Square, Pos 1, 2;
			{
				Character = priest { IsMaster = true; }
			}
		}

		Room 4;
		{
			Pos=54,2;
			Size = 5,5;
			WallSquare = solidterrain(SNOW_TERRAIN),WOOD wall(BRICK_FINE);
			GenerateDoor = false;
			DivineMaster = SEGES;
			Type = temple;
			GenerateLanterns = false;
			ReCalculate = false;

			Square, Pos 0, 2;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = WOOD door;
			}

			Square, Pos 0, 1;
			{
				Items == lantern { SideStackIndex = RIGHT; }
			}

			Square, Pos 2, 2;
			{
				OTerrain = WOOD altar(SEGES);
			}

			Square, Pos 3, 2;
			{
				Character = priest { IsMaster = true; }
			}
		}

		Room 5;
		{
			Pos=2,2;
			Size = 5,5;
			WallSquare = solidterrain(SNOW_TERRAIN),PARCHMENT wall(BRICK_FINE);
			GenerateDoor = false;
			DivineMaster = SOPHOS;
			Type = temple;
			GenerateLanterns = false;
			ReCalculate = false;

			Square, Pos 1, 4;
			{
				Items == lantern { SideStackIndex = UP; }
			}

			Square, Pos 2, 4;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = PARCHMENT door;
			}

			Square, Pos 2, 2;
			{
				OTerrain = PARCHMENT altar(SOPHOS);
			}

			Square, Pos 2, 1;
			{
				Character = priest { IsMaster = true; }
			}
		}

		Room 6;
		{
			Pos=27,1;
			Size = 7,6;
			WallSquare = solidterrain(SNOW_TERRAIN),wall(BRICK_FINE);
			FloorSquare = solidterrain(PARQUET),empty;
			GenerateDoor = false;
			DivineMaster = SOPHOS;
			Type = library;
			GenerateLanterns = false;
			ReCalculate = false;
			
			Square, Pos 3, 5;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = door;
			}

			Square, Pos 3, 0;
			{
				OTerrain = STONE wall(BRICK_PROPAGANDA);
			}

			Square, Pos 3, 3;
			{
				Character = librarian { IsMaster = true; }
			}

			Square, Pos 3, 0;
			{
				Items == lantern { SideStackIndex = DOWN; }
			}

			Square, Pos 2, 5;
			{
				Items == lantern { SideStackIndex = DOWN; }
			}

			Square, Pos 4, 5;
			{
				Items == lantern { SideStackIndex = DOWN; }
			}

			OTerrainMap
			{
				Pos = 1,1;
				Size = 5,4;
				Types
				{
					= = olterraincontainer(BOOK_CASE) { ItemsInside = { 2, Random { MaxPrice = 500; Category = SCROLL|BOOK; }, Random { MaxPrice = 500; Category = SCROLL|BOOK; } } }
				}
			}
			{
				=====
				=...=
				=...=
				=...=
			}
		}

		Room 7;
		{
			Pos=22,53;
			Size = 7,6;
			AltarPossible = false;
			WallSquare = solidterrain(SNOW_TERRAIN),wall(BRICK_FINE);
			FloorSquare = STONE solidterrain(FLOOR),empty;
			GenerateDoor = false;
			DivineMaster = LORICATUS;
			GenerateLanterns = false;
			ReCalculate = false;

			Square, Pos 3, 5;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = door;
			}

			Square, Pos 3, 0;
			{
				OTerrain = STONE wall(BRICK_PROPAGANDA);
			}

			Square, Pos 0, 3;
			{
				Items == lantern { SideStackIndex = RIGHT; }
			}

			Square, Pos 6, 3;
			{
				Items == lantern { SideStackIndex = LEFT; }
			}

			Square, Pos 2, 0;
			{
				Items == lantern { SideStackIndex = DOWN; }
			}

			Square, Pos 4, 0;
			{
				Items == lantern { SideStackIndex = DOWN; }
			}

			Square, Pos 3, 2;
			{
				Character = smith { IsMaster = true; }
			}

			Square, Pos 3, 3;
			{
				OTerrain = decoration(ANVIL);
			}
		}

		Room 8;
		{
			FloorSquare = solidterrain(FLOOR),empty;
			WallSquare = solidterrain(SNOW_TERRAIN), WOOD wall(BRICK_FINE);
			DoorSquare = solidterrain(FLOOR), door;
		}

		Room 9;
		{
			FloorSquare = solidterrain(FLOOR),empty;
			WallSquare = solidterrain(SNOW_TERRAIN), WOOD wall(BRICK_FINE);
			DoorSquare = solidterrain(FLOOR), door;
		}

		Room 10;
		{
			FloorSquare = solidterrain(FLOOR),empty;
			WallSquare = solidterrain(SNOW_TERRAIN), WOOD wall(BRICK_FINE);
			DoorSquare = solidterrain(FLOOR), door;
		}

	}
}

Dungeon NEW_ATTNAM;
{
	Levels = 1;
	Variable XSize = 55;
	Variable YSize = 55;

	Level 0;
	{
		LevelMessage = "You hear someone shouting: \"Faster! Faster! The Empire wants yer bananas!\"";
		Description = "New Attnam";
		ShortDescription = "New Attnam";
		FillSquare = solidterrain(GRASS_TERRAIN),empty;
		Size = XSize, YSize;
		GenerateMonsters = false;
		Rooms = 5 + rand % 3;
		Items = 0;
		ReCalculate = false;
		OnGround = true;
		TeamDefault = NEW_ATTNAM_TEAM;
		AmbientLight = rgb24(130, 130, 130);
		LOSModifier = 48;
		IgnoreDefaultSpecialSquares = false;
		AutoReveal = true;

		RoomDefault
		{
			Pos = 2+rand%35,2+rand%35;
			Size = 4+rand%3,4+rand%3;
			AltarPossible = false;
			WallSquare = solidterrain(GRASS_TERRAIN),WOOD wall(BRICK_PRIMITIVE);
			FloorSquare = solidterrain(GRASS_TERRAIN),empty;
			DoorSquare = solidterrain(GRASS_TERRAIN), WOOD door;
			GenerateDoor = true;
			ReCalculate = true;
			DivineMaster = 0;
			GenerateTunnel = false;
			GenerateLanterns = false;
			Type = normalroom;
			GenerateFountains = false;
			AllowLockedDoors = false;
			AllowBoobyTrappedDoors = false;
			Shape = ROUND_CORNERS;
		}

		Room 0;
		{
			Pos = 4,4;
			Size = 17,19;
			WallSquare = solidterrain(GRASS_TERRAIN),WOOD wall(BRICK_FINE);
			FloorSquare = solidterrain(FLOOR),empty;
			DoorSquare = solidterrain(FLOOR), WOOD door;
			GenerateDoor = false;
			ReCalculate = false;
			DivineMaster = SILVA;
			GenerateLanterns = false;

			OTerrainMap
			{
				Pos = 3,3;
				Size = 11,13;
				Types
				{
					_ = 0;
					o = GOLD wall(BRICK_PROPAGANDA);
					# = GOLD wall(BRICK_FINE);
					^ = decoration(HOLY_TREE);
					c = decoration(COUCH);
				}
			}
			{
				...##o##...
				.###___###.
				##_______##
				#____c____#
				#___^_^___#
				#_________#
				##_______##
				.##_____##.
				..##___##..
				...#___#...
				...#___#...
				...#___#...
				...#___#...
			}

			CharacterMap
			{
				Pos = 3,3;
				Size = 11,13;
				Types
				{
					_ = 0;
					# = 0;
					I = imperialist { Team = COLONIST_TEAM; IsMaster = true; }
					g = guard(ROOKIE) { Team = COLONIST_TEAM; }
					f = femaleslave(NEW_ATTNAM);
					g = guard(ROOKIE) { Team = COLONIST_TEAM; }
				}
			}
			{
				...#####...
				.###_g_###.
				##_______##
				#___fIf___#
				#g_______g#
				#_________#
				##_______##
				.##_____##.
				..##g_g##..
				...#___#...
				...#___#...
				...#___#...
				...#g_g#...
			}

			GTerrainMap
			{
				Pos = 3,3;
				Size = 11,13;
				Types
				{
					# = SILVER solidterrain(FLOOR);
					_ = SILVER solidterrain(FLOOR);
				}
			}
			{
				...#####...
				.###___###.
				##_______##
				#_________#
				#_________#
				#_________#
				##_______##
				.##_____##.
				..##___##..
				...#___#...
				...#___#...
				...#___#...
				...#___#...
			}
		}

		Room 1;
		{
			Type = landingsite;
			Size = 3, 3;
			Pos = 44, 44;
			AltarPossible = false;
			WallSquare = solidterrain(GRASS_TERRAIN),decoration(PALM);
			FloorSquare = solidterrain(LANDING_SITE),empty;
			GenerateDoor = false;
			ReCalculate = false;
			GenerateTunnel = false;
			GenerateLanterns = false;
			GenerateFountains = false;
			Shape = RECTANGLE;

			Square, Pos 1, 1;
			{
				Items = { 10, banana, banana, banana, banana, banana, banana, banana, banana, banana, banana; }
			}
		}

		Square, Pos 12, 22;
		{
			OTerrain = WOOD door;
		}

		Square, Pos 0, 33;
		{
			EntryIndex = STAIRS_UP;
		}

		Square, Random NOT_IN_ROOM;
		{
			OTerrain = boulder;
			Times = 25;
		}

		Square, Random NOT_IN_ROOM;
		{
			OTerrain = decoration(PALM);
			Times = 100;
		}

		Square, Pos 20, 44;
		{
			Character = encourager { Team = COLONIST_TEAM; }
		}

		Square, Pos 0, 45;
		{
			Character = bananagrower;
		}

		Square, Pos 10, 45;
		{
			Character = bananagrower;
		}

		Square, Pos 20, 45;
		{
			Character = bananagrower;
		}

		Square, Pos 30, 45;
		{
			Character = bananagrower;
		}

		Square, Pos 40, 45;
		{
			Character = bananagrower;
		}

		Square, Pos 45, 0;
		{
			Character = ostrich;
		}

		Square, Pos 45, 15;
		{
			Character = ostrich;
		}

		Square, Pos 45, 30;
		{
			Character = ostrich;
		}

		Square, BoundedRandom 0, 22, 28, 54, NOT_IN_ROOM;
		{
			Character = elder;
		}

		Square, Pos 11, 23;
		{
			OTerrain = sign { Text = "The mansion of Viceroy Richel Decos, formerly a temple of nature."; }
		}
	}
}

Dungeon UNDER_WATER_TUNNEL;
{
	Levels = 3;
	Variable XSize = 80;
	Variable YSize = 20;
	Description = "underwater tunnel";
	ShortDescription = "UT";

	LevelDefault
	{
		FillSquare = solidterrain(GROUND),wall(EARTH);
		Size = XSize, YSize;
		Rooms = 5+rand%6;
		Items = 15+rand%16;
		GenerateMonsters = true;
		ReCalculate = true;
		OnGround = false;
		TeamDefault = MONSTER_TEAM;
		AmbientLight = 0;
		LOSModifier = 16;
		IgnoreDefaultSpecialSquares = false;
		DifficultyBase = 20;
		DifficultyDelta = 20;
		MonsterAmountDelta = 0;
		MonsterGenerationIntervalBase = 100;
		MonsterGenerationIntervalDelta = -25;

		Square, Random;
		{
			Items == beartrap { Team = MONSTER_TEAM; Active = true; }
			Times = rand%4;
		}

		RoomDefault
		{
			Pos = 2+rand%(XSize-6),2+rand%(YSize-6);
			Size = 4+rand%8,4+rand%8;
			AltarPossible = true;
			WallSquare = solidterrain(GROUND),wall(BRICK_OLD);
			FloorSquare = solidterrain(PARQUET),empty;
			DoorSquare = solidterrain(PARQUET),door;
			GenerateDoor = true;
			ReCalculate = true;
			DivineMaster = 0;
			GenerateTunnel = true;
			GenerateLanterns = true;
			Type = normalroom;
			GenerateFountains = true;
			AllowLockedDoors = true;
			AllowBoobyTrappedDoors = true;
			Shape = RECTANGLE;
		}
	}

	Level 0;
	{
		IgnoreDefaultSpecialSquares = true;
		MonsterAmountBase = 5;

		RoomDefault
		{
			AltarPossible = false;
			AllowLockedDoors = false;
			AllowBoobyTrappedDoors = false;
		}

		Square, Random;
		{
			Character = spider;
			Times = 2;
		}

		Square, Random;
		{
			Character = kobold;
			Times = 2;
		}

		Square, Random;
		{
			Character = zombie;
			Times = 2;
		}

		Square, Random;
		{
			Character = carnivorousplant;
			Times = 2;
		}

		Square, BoundedRandom 61, 1, 78, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN);
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}

		Room 0;
		{
			Pos = 2+rand%(XSize/4-6),2+rand%(YSize-6);
			Size = 5,5;
			AllowLockedDoors = false;
			AllowBoobyTrappedDoors = false;
			Shape = ROUND_CORNERS;

			Square, Pos 2,2;
			{
				OTerrain = link(STAIRS_UP);
				EntryIndex = STAIRS_UP;
			}

			Square, Pos 2,1;
			{
				Items == lantern;
			}
		}
	}

	Level 1;
	{
		Size = 160, 20;
		MonsterAmountBase = 15;
		Items = 20+rand%21;

		RoomDefault
		{
			Pos = 2+rand%154,2+rand%(YSize-6);
		}

		Square, BoundedRandom 1, 1, 18, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}

		Square, BoundedRandom 141, 1, 158, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP) { AttachedArea = 2; }
			EntryIndex = STAIRS_UP + 1;
			AttachRequired = true;
		}
	}

	Level 2;
	{
		MonsterAmountBase = 10;

		LevelMessage = "This level seems to be somehow alive...";

		Square, BoundedRandom 1, 1, 18, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN) { AttachedArea = 1; AttachedEntry = STAIRS_UP + 1; }
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}

		Room 0;
		{
			Size = 5,5;
			Pos = 3*XSize/4 + rand%(XSize/4-6),2+rand%(YSize-6);
			FloorSquare = solidterrain(GRASS_TERRAIN),empty;
			GenerateFountains = false;
			AltarPossible = false;
			GenerateLanterns = false;

			Square, Pos 2,2;
			{
				OTerrain = link(STAIRS_UP) { AttachedArea = WORLD_MAP; AttachedEntry = UNDER_WATER_TUNNEL_EXIT; }
				EntryIndex = STAIRS_UP;				
			}

			CharacterMap
			{
				Size = 3,3;
				Pos = 1,1;
				Types
				{
					c = carnivorousplant(GREATER);
					g = genetrixvesana;
				}
			}
			{
				.c.
				cgc
				.c.
			}
		}
	}
}
